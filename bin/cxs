#!/usr/bin/env node

const chalk = require('chalk');
const path = require('path');

// ä¸»å‘½ä»¤å¤„ç†å™¨
class CxsCli {
    constructor() {
        this.commands = {
            'list': () => this.handleListCommand(),
            'current': () => this.handleCurrentCommand(),
            'help': () => this.showHelp(),
            '--help': () => this.showHelp(),
            '-h': () => this.showHelp()
        };
    }

    async run() {
        const args = process.argv.slice(2);
        const command = args[0];

        if (!command || command === 'help' || command === '--help' || command === '-h') {
            this.showHelp();
            return;
        }

        if (this.commands[command]) {
            try {
                await this.commands[command]();
            } catch (error) {
                console.error(chalk.red('âŒ æ‰§è¡Œé”™è¯¯:'), error.message);
                process.exit(1);
            }
        } else {
            console.error(chalk.red(`âŒ æœªçŸ¥å‘½ä»¤: ${command}`));
            this.showHelp();
            process.exit(1);
        }
    }

    async handleListCommand() {
        const ListCommand = require('../lib/commands/list-command');
        const listCmd = new ListCommand();
        await listCmd.execute();
    }

    async handleCurrentCommand() {
        const CurrentCommand = require('../lib/commands/current-command');
        const currentCmd = new CurrentCommand();
        await currentCmd.execute();
    }

    showHelp() {
        console.log(chalk.cyan('ğŸ”„ Codex é…ç½®ç®¡ç†å·¥å…· (cxs)'));
        console.log('');
        console.log(chalk.bold('ç”¨æ³•:'));
        console.log('  cxs <command>');
        console.log('');
        console.log(chalk.bold('å¯ç”¨å‘½ä»¤:'));
        console.log('  list       æ˜¾ç¤ºå¯ç”¨è´¦å·åˆ—è¡¨å¹¶åˆ‡æ¢');
        console.log('  current    æ˜¾ç¤ºå½“å‰é…ç½®ä¿¡æ¯');
        console.log('  help       æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯');
        console.log('');
        console.log(chalk.bold('ç¤ºä¾‹:'));
        console.log('  cxs list        # æ˜¾ç¤ºè´¦å·åˆ—è¡¨å¹¶é€‰æ‹©åˆ‡æ¢');
        console.log('  cxs current     # æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é…ç½®');
        console.log('  cxs help        # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯');
        console.log('');
        console.log(chalk.gray('é…ç½®æ–‡ä»¶ä½ç½®: ~/.codex/apiConfig.json'));
    }
}

// è¿è¡Œä¸»å‘½ä»¤
const cli = new CxsCli();
cli.run();